<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Over the Garden Wall - ØªØ¹Ù„Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #bb86fc;
            --secondary-color: #03dac6;
            --background-dark: #121212;
            --surface-dark: #1e1e1e;
            --text-light: #e0e0e0;
            --correct-answer-color: #4CAF50;
            --incorrect-answer-color: #F44336;
        }

        body {
            font-family: 'Cairo', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: var(--background-dark);
            color: var(--text-light);
            direction: rtl;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: var(--surface-dark);
            padding: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            font-weight: 700;
        }

        p {
            font-size: 1.1em;
            text-align: justify;
            margin-bottom: 1em;
            direction: rtl;
        }

        .story-text span {
            cursor: pointer;
            border-bottom: 1px dashed var(--primary-color);
            transition: color 0.2s ease, border-bottom-color 0.2s ease;
            position: relative;
            display: inline-block; /* Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„ØªÙ…ÙˆØ¶Ø¹ Ø§Ù„Ù†Ø³Ø¨ÙŠ */
        }

        .story-text span:hover {
            color: var(--secondary-color);
            border-bottom-color: var(--secondary-color);
        }

        .translation-tooltip {
            background-color: var(--surface-dark);
            border: 1px solid var(--primary-color);
            padding: 8px;
            border-radius: 6px;
            position: absolute;
            z-index: 1000;
            top: 100%;
            right: 0;
            white-space: nowrap;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            text-align: center;
            direction: rtl;
        }

        .translation-tooltip::before {
            content: '';
            position: absolute;
            bottom: 100%;
            right: 10px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent var(--primary-color) transparent;
        }

        .btn {
            display: block;
            width: 180px;
            margin: 25px auto;
            padding: 12px;
            background-color: var(--primary-color);
            color: var(--background-dark);
            text-align: center;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            font-size: 1.05em;
            font-weight: 600;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .quiz-option {
            background-color: #2a2a2a;
            border: 1px solid #424242;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            font-size: 1.05em;
            color: var(--text-light);
        }

        .quiz-option:hover {
            background-color: #3e3e3e;
            border-color: var(--secondary-color);
        }

        .quiz-option.correct {
            background-color: var(--correct-answer-color);
            color: white;
            border-color: var(--correct-answer-color);
        }

        .quiz-option.incorrect {
            background-color: var(--incorrect-answer-color);
            color: white;
            border-color: var(--incorrect-answer-color);
        }

        .quiz-feedback {
            margin-top: 20px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            color: var(--text-light);
        }

        .hidden {
            display: none;
        }

        .summary-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .summary-list li {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #424242;
            font-size: 1.05em;
        }

        .summary-list li:last-child {
            border-bottom: none;
        }

        .quiz-section {
            border-top: 1px solid #3e3e3e;
            padding-top: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .container { padding: 15px; box-shadow: none; border-radius: 0; }
            h1 { font-size: 1.8em; margin-bottom: 15px; }
            p, .quiz-option, .summary-list li { font-size: 1em; }
            .btn { width: 100%; margin: 20px auto; padding: 15px; font-size: 1.1em; }
        }

        @media (max-width: 480px) {
            h1 { font-size: 1.5em; }
            p { font-size: 0.95em; }
            .btn { font-size: 1em; }
        }
    </style>
</head>
<body>

<div class="container">
    <div id="story-page">
        <h1 id="chapter-title">Over the Garden Wall - Ø§Ù„ÙØµÙ„ 1</h1>
        <div id="story-text" class="story-text"></div>
        <button id="next-summary-btn" class="btn hidden">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>

    <div id="summary-page" class="hidden">
        <h1>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªØ±Ø¬Ù…Ø©</h1>
        <p>Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨ØªØ±Ø¬Ù…Ø© <span id="translated-count">0</span> ÙƒÙ„Ù…Ø©.</p>
        <ul id="summary-list" class="summary-list"></ul>
        <button id="next-quiz-btn" class="btn hidden">Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
        <button id="next-comprehension-quiz-btn" class="btn hidden">Ø§Ø¨Ø¯Ø£ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…</button>
    </div>

    <div id="quiz-page" class="hidden">
        <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª</h1>
        <p>Ø§Ø®ØªØ± Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„ÙƒÙ„Ù…Ø©:</p>
        <div id="quiz-question-box"></div>
        <div id="quiz-feedback" class="quiz-feedback"></div>
        <button id="next-page-btn" class="btn hidden">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>

    <div id="comprehension-quiz-page" class="hidden">
        <h1>Ø§Ø®ØªØ¨Ø§Ø± ÙÙ‡Ù… Ø§Ù„ÙØµÙ„</h1>
        <p>Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚ØµØ©:</p>
        <div id="comprehension-quiz-question-box"></div>
        <div id="comprehension-quiz-feedback" class="quiz-feedback"></div>
        <button id="restart-btn" class="btn hidden">Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
    </div>
</div>

<script>
    const chapterText = `
    Wirt and Greg are brothers. One day, they suddenly wake up in a very strange forest. The forest is dark, and the air is cold. Big trees grow close together, and strange sounds come from the wind. Wirt looks around with fear in his eyes. Greg, however, does not feel afraid. He smiles and sings a silly song.

    Wirt is the older brother. He is serious, shy, and always worried. He thinks too much and is afraid of making mistakes. Greg is the younger brother. He is happy, playful, and full of strange ideas. He carries a little frog in his pocket. The frog does not have a name, so Greg gives it a new name every few minutes. As the brothers walk, they feel lost. Wirt says, â€œWe donâ€™t know where we are. How can we go home?â€ Greg laughs and answers, â€œDonâ€™t worry, Wirt. This is an adventure!â€

    Suddenly, they hear a strange voice. A small bluebird flies near them. The bird can talk! Her name is Beatrice. She says, â€œYou boys look lost. Maybe I can help you.â€ Wirt is surprised and does not trust her. He says, â€œBirds do not talk. This is not normal.â€ Greg, however, is excited. He says, â€œCool! A talking bird! Letâ€™s be friends.â€

    Beatrice tells them that the forest is dangerous. There is a terrible creature living there. His name is The Beast. She says, â€œIf you are not careful, the Beast will find you.â€ Wirt feels afraid again, but Greg only laughs. Later, they meet an old man. He is tall, with a long beard and sad eyes. He carries a big lantern and an axe. The man is called The Woodsman. He lives in the forest and cuts down trees. He tells Wirt and Greg, â€œChildren should not walk here. The Beast is always near. He looks for lost souls.â€ Wirtâ€™s heart beats fast. He imagines the Beast hiding behind the trees. He thinks about home, about safety, and about how lost they are. But Greg is different. He plays with his frog and sings a silly rhyme. He even tries to make the Woodsman smile. The Woodsman explains that he cuts trees to make oil for his lantern. The light is important, because it keeps away the darkness. Wirt does not understand, but he feels the Woodsman is hiding something. When the night comes, the forest becomes even darker. The brothers walk slowly. The wind moves the branches, and strange shadows appear. Wirt says, â€œGreg, be quiet. We donâ€™t know what is out there.â€ But Greg answers, â€œDonâ€™t worry, Wirt. I will protect you with my frog!â€

    The brothers argue a little. Wirt thinks Greg is not serious enough. Greg thinks Wirt is too serious and always afraid. But deep inside, they both love each other.

    Suddenly, they hear a sound in the forest. A dark shape moves between the trees. Wirt whispers, â€œIs that the Beast?â€ Greg runs forward and says, â€œHello?â€ But it is only a small animal. Wirt feels angry and says, â€œGreg, stop running! This place is dangerous!â€ Later, the Woodsman appears again. His lantern shines in the dark. He warns them once more: â€œThe Beast is watching you. Do not lose hope. If you give up, the Beast will take your soul.â€ Wirt shivers, and Greg stays quiet for the first time. At the end of the episode, the brothers continue walking through the forest. Wirt looks tired, but Greg still tries to stay positive. Beatrice flies above them, leading the way. The night is long, and the forest is full of secrets. They do not know how to escape, but they promise to stay together. The story of their journey has only just begun.
    `;

    const wordTranslations = {
        "wirt": "ÙˆÙŠØ±Øª", "greg": "ØºØ±ÙŠØº", "are": "Ù‡Ù…Ø§", "brothers": "Ø£Ø®ÙˆØ§Ù†", "one": "ÙˆØ§Ø­Ø¯", "day": "ÙŠÙˆÙ…",
        "they": "Ù‡Ù…", "suddenly": "ÙØ¬Ø£Ø©", "wake": "ÙŠØ³ØªÙŠÙ‚Ø¸ÙˆÙ†", "up": "Ø§Ø³ØªÙŠÙ‚Ø§Ø¸", "in": "ÙÙŠ", "a": "Ø£Ø¯Ø§Ø© ØªÙ†ÙƒÙŠØ±",
        "very": "Ø¬Ø¯Ø§Ù‹", "strange": "ØºØ±ÙŠØ¨Ø©", "forest": "ØºØ§Ø¨Ø©", "the": "Ø§Ù„Ù€ (Ø£Ø¯Ø§Ø© ØªØ¹Ø±ÙŠÙ)", "is": "Ù‡Ùˆ/Ù‡ÙŠ",
        "dark": "Ù…Ø¸Ù„Ù…Ø©", "and": "Ùˆ", "air": "Ø§Ù„Ù‡ÙˆØ§Ø¡", "cold": "Ø¨Ø§Ø±Ø¯", "big": "ÙƒØ¨ÙŠØ±Ø©", "trees": "Ø£Ø´Ø¬Ø§Ø±",
        "grow": "ØªÙ†Ù…Ùˆ", "close": "Ù‚Ø±ÙŠØ¨Ø©", "together": "Ù…Ø¹Ø§Ù‹", "sounds": "Ø£ØµÙˆØ§Øª", "come": "ØªØ£ØªÙŠ", "from": "Ù…Ù†",
        "wind": "Ø§Ù„Ø±ÙŠØ§Ø­", "looks": "ÙŠÙ†Ø¸Ø±", "around": "Ø­ÙˆÙ„", "with": "Ø¨Ù€", "fear": "Ø®ÙˆÙ", "his": "Ù„Ù‡",
        "eyes": "Ø¹ÙŠÙ†ÙŠÙ‡", "however": "Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„", "does": "ÙŠÙÙ€ (Ù„Ù„Ù†ÙÙŠ)", "not": "Ù„Ø§", "feel": "ÙŠØ´Ø¹Ø±ÙˆÙ†",
        "afraid": "Ø¨Ø§Ù„Ø®ÙˆÙ", "he": "Ù‡Ùˆ", "smiles": "ÙŠØ¨ØªØ³Ù…", "sings": "ÙŠØºÙ†ÙŠ", "silly": "Ù…Ø¶Ø­ÙƒØ©", "song": "Ø£ØºÙ†ÙŠØ©",
        "older": "Ø§Ù„Ø£ÙƒØ¨Ø±", "serious": "Ø¬Ø¯ÙŠ", "shy": "Ø®Ø¬ÙˆÙ„", "always": "Ø¯Ø§Ø¦Ù…Ø§Ù‹", "worried": "Ù‚Ù„Ù‚",
        "thinks": "ÙŠÙÙƒØ±", "too": "Ø¬Ø¯Ø§Ù‹", "much": "ÙƒØ«ÙŠØ±Ø§Ù‹", "making": "Ø§Ø±ØªÙƒØ§Ø¨", "mistakes": "Ø£Ø®Ø·Ø§Ø¡",
        "younger": "Ø§Ù„Ø£ØµØºØ±", "happy": "Ø³Ø¹ÙŠØ¯", "playful": "Ù…Ø±Ø­", "full": "Ù…Ù„ÙŠØ¡ Ø¨Ù€", "ideas": "Ø£ÙÙƒØ§Ø±",
        "carries": "ÙŠØ­Ù…Ù„", "little": "ØµØºÙŠØ±", "frog": "Ø¶ÙØ¯Ø¹", "pocket": "Ø¬ÙŠØ¨Ù‡", "has": "ÙŠÙ…Ù„Ùƒ", "have": "ÙŠÙ…ØªÙ„Ùƒ",
        "name": "Ø§Ø³Ù…", "so": "Ù„Ø°Ù„Ùƒ", "gives": "ÙŠØ¹Ø·ÙŠÙ‡", "it": "Ù„Ù‡", "new": "Ø¬Ø¯ÙŠØ¯", "every": "ÙƒÙ„",
        "few": "Ø¨Ø¶Ø¹", "minutes": "Ø¯Ù‚Ø§Ø¦Ù‚", "as": "Ø¨ÙŠÙ†Ù…Ø§", "walk": "ÙŠÙ…Ø´ÙˆÙ†", "they": "Ù‡Ù…", "lost": "ØªØ§Ø¦Ù‡ÙŠÙ†",
        "says": "ÙŠÙ‚ÙˆÙ„", "don't": "Ù„Ø§", "know": "Ù†Ø¹Ø±Ù", "where": "Ø£ÙŠÙ†", "we": "Ù†Ø­Ù†", "can": "ÙŠÙ…ÙƒÙ†Ù†Ø§",
        "go": "Ù†Ø°Ù‡Ø¨", "home": "Ù„Ù„Ù…Ù†Ø²Ù„", "laughs": "ÙŠØ¶Ø­Ùƒ", "answers": "ÙŠØ¬ÙŠØ¨", "worry": "ØªÙ‚Ù„Ù‚",
        "this": "Ù‡Ø°Ù‡", "is": "Ù‡ÙŠ", "an": "Ø£Ø¯Ø§Ø© ØªÙ†ÙƒÙŠØ±", "adventure": "Ù…ØºØ§Ù…Ø±Ø©", "suddenly": "ÙØ¬Ø£Ø©",
        "hear": "ÙŠØ³Ù…Ø¹ÙˆÙ†", "voice": "ØµÙˆØª", "small": "ØµØºÙŠØ±Ø©", "bluebird": "Ø·Ø§Ø¦Ø± Ø£Ø²Ø±Ù‚", "flies": "ØªØ·ÙŠØ±",
        "near": "Ù‚Ø±Ø¨", "bird": "Ø·Ø§Ø¦Ø±", "can": "ÙŠÙ…ÙƒÙ†Ù‡Ø§", "talk": "ØªØªÙƒÙ„Ù…", "her": "Ø§Ø³Ù…Ù‡Ø§", "beatrice": "Ø¨ÙŠØ§ØªØ±ÙŠØ³",
        "she": "Ù‡ÙŠ", "says": "ØªÙ‚ÙˆÙ„", "you": "Ø£Ù†ØªÙ…", "boys": "Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø£ÙˆÙ„Ø§Ø¯", "look": "ØªØ¨Ø¯ÙˆÙ†", "maybe": "Ø±Ø¨Ù…Ø§", "i": "Ø£Ù†Ø§", "help": "Ø£Ø³Ø§Ø¹Ø¯ÙƒÙ…",
        "surprised": "Ù…ØªÙØ§Ø¬Ø¦", "trust": "ÙŠØ«Ù‚", "normal": "Ø·Ø¨ÙŠØ¹ÙŠ", "excited": "Ù…ØªØ­Ù…Ø³", "cool": "Ø±Ø§Ø¦Ø¹",
        "let's": "Ø¯Ø¹Ù†Ø§ Ù†ÙƒÙˆÙ†", "be": "Ù†ÙƒÙˆÙ†", "friends": "Ø£ØµØ¯Ù‚Ø§Ø¡", "tells": "ØªØ®Ø¨Ø±Ù‡Ù…", "that": "Ø£Ù†", "dangerous": "Ø®Ø·ÙŠØ±Ø©",
        "there": "ÙŠÙˆØ¬Ø¯", "a": "Ø£Ø¯Ø§Ø© ØªÙ†ÙƒÙŠØ±", "terrible": "Ø±Ù‡ÙŠØ¨", "creature": "Ù…Ø®Ù„ÙˆÙ‚", "living": "ÙŠØ¹ÙŠØ´",
        "his": "Ø§Ø³Ù…Ù‡", "the": "Ø§Ù„Ù€", "beast": "Ø§Ù„ÙˆØ­Ø´", "if": "Ø¥Ø°Ø§", "are": "ÙƒÙ†ØªÙ…", "not": "Ù„Ø§", "careful": "Ø­Ø°Ø±ÙŠÙ†",
        "will": "Ø³ÙˆÙ", "find": "ÙŠØ¬Ø¯ÙƒÙ…", "feels": "ÙŠØ´Ø¹Ø±", "only": "ÙÙ‚Ø·", "laughs": "ÙŠØ¶Ø­Ùƒ", "later": "Ù„Ø§Ø­Ù‚Ø§Ù‹",
        "they": "Ù‡Ù…", "meet": "ÙŠÙ‚Ø§Ø¨Ù„ÙˆÙ†", "old": "Ø¹Ø¬ÙˆØ²", "man": "Ø±Ø¬Ù„", "tall": "Ø·ÙˆÙŠÙ„", "long": "Ø·ÙˆÙŠÙ„Ø©", "beard": "Ù„Ø­ÙŠØ©",
        "sad": "Ø­Ø²ÙŠÙ†Ø©", "carries": "ÙŠØ­Ù…Ù„", "big": "ÙƒØ¨ÙŠØ±", "lantern": "ÙØ§Ù†ÙˆØ³", "axe": "ÙØ£Ø³", "called": "ÙŠÙØ¯Ø¹Ù‰",
        "woodsman": "Ø§Ù„Ø­Ø·Ø§Ø¨", "lives": "ÙŠØ¹ÙŠØ´", "cuts": "ÙŠÙ‚Ø·Ø¹", "down": "ÙŠÙØ³Ù‚Ø·", "children": "Ø§Ù„Ø£Ø·ÙØ§Ù„", "should": "ÙŠØ¬Ø¨",
        "walk": "ÙŠØ³ÙŠØ±ÙˆØ§", "here": "Ù‡Ù†Ø§", "always": "Ø¯Ø§Ø¦Ù…Ø§Ù‹", "near": "Ø¨Ø§Ù„Ù‚Ø±Ø¨", "looks": "ÙŠØ¨Ø­Ø«", "for": "Ø¹Ù†",
        "lost": "Ø§Ù„Ø¶Ø§Ø¦Ø¹Ø©", "souls": "Ø§Ù„Ø£Ø±ÙˆØ§Ø­", "heart": "Ù‚Ù„Ø¨Ù‡", "beats": "ÙŠÙ†Ø¨Ø¶", "fast": "Ø¨Ø³Ø±Ø¹Ø©", "imagines": "ÙŠØªØ®ÙŠÙ„",
        "hiding": "ÙŠØ®ØªØ¨Ø¦", "behind": "Ø®Ù„Ù", "home": "Ø§Ù„Ù…Ù†Ø²Ù„", "safety": "Ø§Ù„Ø£Ù…Ø§Ù†", "how": "Ù…Ø¯Ù‰", "are": "Ù‡Ù…",
        "different": "Ù…Ø®ØªÙ„Ù", "plays": "ÙŠÙ„Ø¹Ø¨", "his": "Ø¨Ù€", "frog": "Ø¶ÙØ¯Ø¹Ù‡", "sings": "ÙŠØºÙ†ÙŠ", "silly": "Ù…Ø¶Ø­ÙƒØ©",
        "rhyme": "Ù‚Ø§ÙÙŠÙ‡", "even": "Ø­ØªÙ‰", "tries": "ÙŠØ­Ø§ÙˆÙ„", "make": "ÙŠØ¬Ø¹Ù„", "smile": "ÙŠØ¨ØªØ³Ù…", "explains": "ÙŠØ´Ø±Ø­",
        "oil": "Ø²ÙŠØª", "important": "Ù…Ù‡Ù…", "because": "Ù„Ø£Ù†Ù‡", "keeps": "ÙŠØ¨Ø¹Ø¯", "away": "Ø¨Ø¹ÙŠØ¯Ø§Ù‹", "darkness": "Ø§Ù„Ø¸Ù„Ø§Ù…",
        "does": "ÙŠÙÙ€ (Ù„Ù„Ù†ÙÙŠ)", "understand": "ÙŠÙÙ‡Ù…", "hiding": "ÙŠØ®ÙÙŠ", "something": "Ø´ÙŠØ¦Ø§Ù‹", "when": "Ø¹Ù†Ø¯Ù…Ø§",
        "comes": "ÙŠØ£ØªÙŠ", "night": "Ø§Ù„Ù„ÙŠÙ„", "becomes": "ÙŠØµØ¨Ø­", "even": "Ø­ØªÙ‰", "darker": "Ø£ÙƒØ«Ø± Ø¸Ù„Ù…Ø©",
        "slowly": "Ø¨Ø¨Ø·Ø¡", "wind": "Ø§Ù„Ø±ÙŠØ§Ø­", "moves": "ØªØ­Ø±Ùƒ", "branches": "Ø§Ù„ÙØ±ÙˆØ¹", "shadows": "Ø¸Ù„Ø§Ù„",
        "appear": "ØªØ¸Ù‡Ø±", "quiet": "Ù‡Ø§Ø¯Ø¦", "don't": "Ù„Ø§", "know": "Ù†Ø¹Ø±Ù", "what": "Ù…Ø§Ø°Ø§", "out": "ÙÙŠ Ø§Ù„Ø®Ø§Ø±Ø¬",
        "there": "Ù‡Ù†Ø§Ùƒ", "answers": "ÙŠØ¬ÙŠØ¨", "will": "Ø³ÙˆÙ", "protect": "Ø£Ø­Ù…ÙŠÙƒ", "with": "Ø¨Ù€", "my": "Ø¶ÙØ¯Ø¹ÙŠ",
        "argue": "ÙŠØªØ´Ø§Ø¬Ø±Ø§Ù†", "a": "(Ø£Ø¯Ø§Ø© ØªÙ†ÙƒÙŠØ±)", "little": "Ù‚Ù„ÙŠÙ„Ø§Ù‹", "serious": "Ø¬Ø§Ø¯", "enough": "Ø¨Ù…Ø§ ÙŠÙƒÙÙŠ",
        "too": "Ø¬Ø¯Ø§Ù‹", "deep": "Ø¹Ù…ÙŠÙ‚", "inside": "Ø¨Ø¯Ø§Ø®Ù„Ù‡Ù…", "both": "ÙƒÙ„Ø§Ù‡Ù…Ø§", "love": "ÙŠØ­Ø¨Ø§Ù†",
        "each": "Ø¨Ø¹Ø¶Ù‡Ù…Ø§", "other": "Ø§Ù„Ø¢Ø®Ø±", "sound": "ØµÙˆØª", "shape": "Ø´ÙƒÙ„", "moves": "ÙŠØªØ­Ø±Ùƒ",
        "between": "Ø¨ÙŠÙ†", "whispers": "ÙŠÙ‡Ù…Ø³", "hello": "Ù…Ø±Ø­Ø¨Ø§Ù‹", "only": "ÙÙ‚Ø·", "animal": "Ø­ÙŠÙˆØ§Ù†",
        "angry": "ØºØ§Ø¶Ø¨", "stop": "ØªÙˆÙ‚Ù", "running": "Ø§Ù„Ø±ÙƒØ¶", "place": "Ø§Ù„Ù…ÙƒØ§Ù†", "dangerous": "Ø®Ø·ÙŠØ±",
        "later": "Ù„Ø§Ø­Ù‚Ø§Ù‹", "appears": "ÙŠØ¸Ù‡Ø±", "again": "Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "shines": "ÙŠÙ„Ù…Ø¹", "warns": "ÙŠØ­Ø°Ø±Ù‡Ù…",
        "once": "Ù…Ø±Ø©", "more": "Ø£Ø®Ø±Ù‰", "watching": "ÙŠØ±Ø§Ù‚Ø¨ÙƒÙ…", "do": "ØªÙÙ‚Ø¯ÙˆØ§", "lose": "ØªÙÙ‚Ø¯ÙˆØ§",
        "hope": "Ø§Ù„Ø£Ù…Ù„", "if": "Ø¥Ø°Ø§", "give": "ØªØ³ØªØ³Ù„Ù…ÙˆØ§", "up": "ØªØ³ØªØ³Ù„Ù…ÙˆØ§", "take": "ÙŠØ£Ø®Ø°",
        "soul": "Ø±ÙˆØ­ÙƒÙ…", "shivers": "ÙŠØ±ØªØ¬Ù", "stays": "ÙŠØ¨Ù‚Ù‰", "for": "Ù„Ù€", "first": "Ø£ÙˆÙ„", "time": "Ù…Ø±Ø©",
        "at": "ÙÙŠ", "end": "Ù†Ù‡Ø§ÙŠØ©", "episode": "Ø§Ù„Ø­Ù„Ù‚Ø©", "continue": "ÙŠÙˆØ§ØµÙ„ÙˆÙ†", "walking": "Ø§Ù„Ø³ÙŠØ±",
        "through": "Ø®Ù„Ø§Ù„", "looks": "ÙŠØ¨Ø¯Ùˆ", "tired": "Ù…ØªØ¹Ø¨", "still": "Ù„Ø§ ÙŠØ²Ø§Ù„", "tries": "ÙŠØ­Ø§ÙˆÙ„",
        "positive": "Ø¥ÙŠØ¬Ø§Ø¨ÙŠ", "flies": "ØªØ·ÙŠØ±", "above": "ÙÙˆÙ‚", "leading": "ØªÙ‚ÙˆØ¯", "the": "Ø§Ù„Ù€", "way": "Ø§Ù„Ø·Ø±ÙŠÙ‚",
        "night": "Ø§Ù„Ù„ÙŠÙ„", "long": "Ø·ÙˆÙŠÙ„Ø©", "full": "Ù…Ù„ÙŠØ¦Ø©", "secrets": "Ø£Ø³Ø±Ø§Ø±", "do": "ÙŠÙØ¹Ù„ÙˆÙ†", "know": "ÙŠØ¹Ø±ÙÙˆÙ†",
        "how": "ÙƒÙŠÙ", "escape": "ÙŠÙ‡Ø±Ø¨ÙˆØ§", "but": "Ù„ÙƒÙ†", "promise": "ÙŠØ¹Ø¯ÙˆÙ†", "stay": "ÙŠØ¨Ù‚ÙˆÙ†", "story": "Ù‚ØµØ©",
        "journey": "Ø±Ø­Ù„ØªÙ‡Ù…", "has": "Ù‚Ø¯", "just": "ØªÙˆÙ‘Ø§Ù‹", "begun": "Ø¨Ø¯Ø£Øª"
    };


    const comprehensionQuestions = [
        {
            question: "Ù…Ù† Ù‡Ù… Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ Ù‚Ø§Ø¨Ù„Ù‡Ø§ Ø§Ù„Ø£Ø®ÙˆØ§Ù† ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©ØŸ",
            options: ["Ø§Ù„Ø­Ø·Ø§Ø¨ ÙˆØ¨ÙŠØ§ØªØ±ÙŠØ³", "Ø§Ù„ÙˆØ­Ø´ ÙˆØ§Ù„Ø­Ø·Ø§Ø¨", "Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ÙˆØ§Ù„Ø¶ÙØ¯Ø¹"],
            answer: "Ø§Ù„Ø­Ø·Ø§Ø¨ ÙˆØ¨ÙŠØ§ØªØ±ÙŠØ³"
        },
        {
            question: "Ù…Ø§ Ù‡ÙŠ Ù…Ø´Ø§Ø¹Ø± ÙˆÙŠØ±Øª ØªØ¬Ø§Ù‡ Ø§Ù„ØºØ§Ø¨Ø© ÙˆØ§Ù„Ù…ØºØ§Ù…Ø±Ø©ØŸ",
            options: ["Ø³Ø¹ÙŠØ¯ ÙˆÙ…ØªØ­Ù…Ø³", "Ù…ØªÙØ§Ø¦Ù„ ÙˆÙ…Ø±Ø­", "Ù‚Ù„Ù‚ ÙˆØ®Ø§Ø¦Ù"],
            answer: "Ù‚Ù„Ù‚ ÙˆØ®Ø§Ø¦Ù"
        },
        {
            question: "Ù„Ù…Ø§Ø°Ø§ ÙŠØ­Ø°Ø± Ø§Ù„Ø­Ø·Ø§Ø¨ Ø§Ù„Ø£Ø®ÙˆØ§Ù† Ù…Ù† Ø§Ù„ÙˆØ­Ø´ØŸ",
            options: ["Ù„Ø£Ù† Ø§Ù„ÙˆØ­Ø´ ÙŠØ³Ø±Ù‚ Ø§Ù„Ø·Ø¹Ø§Ù…", "Ù„Ø£Ù† Ø§Ù„ÙˆØ­Ø´ ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ø¶Ø§Ø¦Ø¹Ø©", "Ù„Ø£Ù† Ø§Ù„ÙˆØ­Ø´ ÙŠÙ‚Ø·Ø¹ Ø§Ù„Ø£Ø´Ø¬Ø§Ø±"],
            answer: "Ù„Ø£Ù† Ø§Ù„ÙˆØ­Ø´ ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ø¶Ø§Ø¦Ø¹Ø©"
        }
    ];

    let translatedWords = new Set();
    let quizWords = [];
    let currentQuizIndex = 0;
    let currentComprehensionIndex = 0;

    const storyPage = document.getElementById('story-page');
    const summaryPage = document.getElementById('summary-page');
    const quizPage = document.getElementById('quiz-page');
    const comprehensionQuizPage = document.getElementById('comprehension-quiz-page');

    const nextStoryBtn = document.getElementById('next-summary-btn');
    const nextQuizBtn = document.getElementById('next-quiz-btn');
    const nextComprehensionQuizBtn = document.getElementById('next-comprehension-quiz-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const restartBtn = document.getElementById('restart-btn');

    const translatedCountSpan = document.getElementById('translated-count');
    const summaryList = document.getElementById('summary-list');
    const storyTextDiv = document.getElementById('story-text');

    const quizQuestionBox = document.getElementById('quiz-question-box');
    const quizFeedbackDiv = document.getElementById('quiz-feedback');
    const comprehensionQuizQuestionBox = document.getElementById('comprehension-quiz-question-box');
    const comprehensionQuizFeedbackDiv = document.getElementById('comprehension-quiz-feedback');

    function initStory() {
        storyTextDiv.innerHTML = '';
        const paragraphs = chapterText.split('\n\n').map(p => p.trim()).filter(p => p);
        paragraphs.forEach(pText => {
            const p = document.createElement('p');
            p.dir = "ltr";
            const words = pText.split(' ');
            p.innerHTML = words.map(word => {
                const cleanWord = word.replace(/[.,?!:"'()]/g, '').toLowerCase();
                const hasTranslation = wordTranslations.hasOwnProperty(cleanWord);
                if (hasTranslation) {
                    return `<span>${word}<div class="translation-tooltip">${wordTranslations[cleanWord]}</div></span>`;
                } else {
                    return word;
                }
            }).join(' ');
            storyTextDiv.appendChild(p);
        });
        storyTextDiv.removeEventListener('click', handleStoryClick);
        storyTextDiv.addEventListener('click', handleStoryClick);
        nextStoryBtn.classList.remove('hidden');
    }

    function handleStoryClick(e) {
        if (e.target.tagName === 'SPAN') {
            const originalWord = e.target.innerText.replace(/[.,?!:"'()]/g, '').toLowerCase();
            const tooltip = e.target.querySelector('.translation-tooltip');
            if (tooltip) {
                if (tooltip.style.display === 'block') {
                    tooltip.style.display = 'none';
                    tooltip.style.opacity = '0';
                } else {
                    tooltip.style.display = 'block';
                    tooltip.style.opacity = '1';
                }
                translatedWords.add(originalWord);
                updateTranslatedCount();
            }
        }
    }
    
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.story-text span')) {
            document.querySelectorAll('.translation-tooltip').forEach(tooltip => {
                tooltip.style.display = 'none';
                tooltip.style.opacity = '0';
            });
        }
    });


    function updateTranslatedCount() {
        translatedCountSpan.innerText = translatedWords.size;
    }

    function goToSummaryPage() {
        storyPage.classList.add('hidden');
        summaryPage.classList.remove('hidden');
        nextStoryBtn.classList.add('hidden');
        document.querySelectorAll('.translation-tooltip').forEach(tooltip => {
            tooltip.style.display = 'none';
        });

        if (translatedWords.size > 0) {
            nextQuizBtn.classList.remove('hidden');
        } else {
            nextQuizBtn.classList.add('hidden');
        }
        nextComprehensionQuizBtn.classList.remove('hidden');
        renderSummary();
    }

    function renderSummary() {
        summaryList.innerHTML = '';
        if (translatedWords.size > 0) {
            translatedWords.forEach(word => {
                const li = document.createElement('li');
                li.innerHTML = `<span dir="ltr">${word}</span> <span>${wordTranslations[word]}</span>`;
                summaryList.appendChild(li);
            });
        }
    }

    function goToQuizPage() {
        summaryPage.classList.add('hidden');
        quizPage.classList.remove('hidden');
        nextQuizBtn.classList.add('hidden');
        nextComprehensionQuizBtn.classList.add('hidden');
        startWordQuiz();
    }

    function goToComprehensionQuizPage() {
        summaryPage.classList.add('hidden');
        comprehensionQuizPage.classList.remove('hidden');
        nextQuizBtn.classList.add('hidden');
        nextComprehensionQuizBtn.classList.add('hidden');
        startComprehensionQuiz();
    }

    function startWordQuiz() {
        quizWords = Array.from(translatedWords);
        shuffleArray(quizWords);
        currentQuizIndex = 0;
        showWordQuizQuestion();
    }

    function startComprehensionQuiz() {
        currentComprehensionIndex = 0;
        showComprehensionQuizQuestion();
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function showWordQuizQuestion() {
        quizFeedbackDiv.innerText = '';
        if (currentQuizIndex >= quizWords.length) {
            quizQuestionBox.innerHTML = `<p style="text-align: center;">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙ„Ù…Ø§Øª! ğŸ‰</p>`;
            nextPageBtn.classList.remove('hidden');
            nextPageBtn.innerText = "Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…";
            nextPageBtn.removeEventListener('click', showNextWordQuizQuestion);
            nextPageBtn.addEventListener('click', () => {
                quizPage.classList.add('hidden');
                goToComprehensionQuizPage();
            });
            return;
        }

        const questionWord = quizWords[currentQuizIndex];
        const correctAnswer = wordTranslations[questionWord];
        const options = generateQuizOptions(correctAnswer);

        quizQuestionBox.innerHTML = `
            <p style="text-align: center; font-size: 1.2em;" dir="ltr">**${questionWord}**</p>
            ${options.map(option => `<div class="quiz-option" data-answer="${option}">${option}</div>`).join('')}
        `;

        document.querySelectorAll('.quiz-option').forEach(optionDiv => {
            optionDiv.addEventListener('click', handleWordQuizAnswer);
        });
    }

    function generateQuizOptions(correctAnswer) {
        const allTranslations = Object.values(wordTranslations);
        const uniqueOptions = new Set();
        uniqueOptions.add(correctAnswer);

        while (uniqueOptions.size < 4 && uniqueOptions.size < allTranslations.length) {
            const randomIndex = Math.floor(Math.random() * allTranslations.length);
            const randomOption = allTranslations[randomIndex];
            if (randomOption !== correctAnswer) {
                uniqueOptions.add(randomOption);
            }
        }

        const optionsArray = Array.from(uniqueOptions);
        shuffleArray(optionsArray);
        return optionsArray;
    }

    function handleWordQuizAnswer(e) {
        const selectedOption = e.target;
        const selectedAnswer = selectedOption.dataset.answer;
        const correctAnswer = wordTranslations[quizWords[currentQuizIndex]];

        if (selectedAnswer === correctAnswer) {
            selectedOption.classList.add('correct');
            quizFeedbackDiv.innerText = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ…';
        } else {
            selectedOption.classList.add('incorrect');
            const correctOption = document.querySelector(`.quiz-option[data-answer="${correctAnswer}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            quizFeedbackDiv.innerText = `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${correctAnswer} âŒ`;
        }

        setTimeout(() => {
            currentQuizIndex++;
            showWordQuizQuestion();
        }, 1500);
    }

    function showComprehensionQuizQuestion() {
        comprehensionQuizFeedbackDiv.innerText = '';
        if (currentComprehensionIndex >= comprehensionQuestions.length) {
            comprehensionQuizQuestionBox.innerHTML = `<p style="text-align: center;">Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ‡Ù…! ğŸ‰</p>`;
            restartBtn.classList.remove('hidden');
            return;
        }

        const questionData = comprehensionQuestions[currentComprehensionIndex];
        const options = [...questionData.options];
        shuffleArray(options);

        comprehensionQuizQuestionBox.innerHTML = `
            <p style="text-align: center; font-size: 1.2em;">**${questionData.question}**</p>
            ${options.map(option => `<div class="quiz-option" data-answer="${option}">${option}</div>`).join('')}
        `;

        document.querySelectorAll('.quiz-option').forEach(optionDiv => {
            optionDiv.addEventListener('click', handleComprehensionQuizAnswer);
        });
    }

    function handleComprehensionQuizAnswer(e) {
        const selectedOption = e.target;
        const selectedAnswer = selectedOption.dataset.answer;
        const correctAnswer = comprehensionQuestions[currentComprehensionIndex].answer;

        if (selectedAnswer === correctAnswer) {
            selectedOption.classList.add('correct');
            comprehensionQuizFeedbackDiv.innerText = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! âœ…';
        } else {
            selectedOption.classList.add('incorrect');
            const correctOption = document.querySelector(`.quiz-option[data-answer="${correctAnswer}"]`);
            if (correctOption) {
                correctOption.classList.add('correct');
            }
            comprehensionQuizFeedbackDiv.innerText = `Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ: ${correctAnswer} âŒ`;
        }

        setTimeout(() => {
            currentComprehensionIndex++;
            showComprehensionQuizQuestion();
        }, 1500);
    }

    function restartApp() {
        translatedWords.clear();
        updateTranslatedCount();
        quizWords = [];
        currentQuizIndex = 0;
        currentComprehensionIndex = 0;
        storyPage.classList.remove('hidden');
        summaryPage.classList.add('hidden');
        quizPage.classList.add('hidden');
        comprehensionQuizPage.classList.add('hidden');
        restartBtn.classList.add('hidden');
        nextPageBtn.classList.add('hidden');
        initStory();
    }

    document.addEventListener('DOMContentLoaded', () => {
        initStory();
        nextStoryBtn.addEventListener('click', goToSummaryPage);
        nextQuizBtn.addEventListener('click', goToQuizPage);
        nextComprehensionQuizBtn.addEventListener('click', goToComprehensionQuizPage);
        restartBtn.addEventListener('click', restartApp);
    });
</script>

</body>
</html>
